---
draft: true
date:
  created: 2024-09-18
  updated: 2025-01-02
categories:
  - Learning
  - Memo
authors:
  - zhazi
---

# 笔记：linux 服务器间同步命令 -- rsync

!!! info "参考文献"

    1. [CSDN：揭秘强大的文件同步利器Rsycn](https://blog.csdn.net/hy199707/article/details/137499793)
    2. [博客园：通过rsycn实现数据同步](https://www.cnblogs.com/feng0919/p/11223537.html)

<!-- more -->

!!! info "场景描述"

    需要在两台远程服务器之间进行文件传输，需要将服务器 A 上的 /path/to/source_dir 文件夹内容同步到服务器 B 上的 /path/to/sync_dir 文件夹下。这两台服务器之间是连通的，服务器 A 使用密码登录，端口设置为 1111，服务器 B 使用密钥登录，端口设置为 2222。

## 命令及解释

使用该命令前需要搞明白本次传输中的三个角色：备份源、发起端（也是客户端）、服务端。在我的场景中，备份源是 `{User}@{Server A IP}:\path\to\source_dir`，发起端是服务器 A， 服务端是服务器 B。

!!! quote "见参考文献 1. (有删改)"

    **备份源（Backup Source）**： 想要复制或同步数据的位置。在 rsync 进程中，它可以是本地的一个目录，也可以是远程服务器上的目录。

    **发起端（Initiator / Sender）**： 发起端是启动 rsync 同步操作的那台计算机或进程。发起端需要指定源路径（要同步的文件和目录），以及目标路径（同步到何处）。

    **服务端（Server）**： 在 rsync 中，服务端是指运行 rsync daemon 的机器，这个守护进程监听特定端口等待客户端连接并发起同步请求。
    **客户端（Client）**： 客户端是与服务端进行交互以执行同步任务的机器或进程。在 rsync 中，发起同步操作的一方同时也是客户端。

在一次同步中，这些角色的交互如下所示：

!!! quote "见参考文献 1."

    在一次 rsync 数据同步过程中：

    - 备份源提供数据；
    - 发起端（同时也是客户端）启动同步操作；
    - 服务端响应同步请求并提供同步服务；
    - 数据从备份源经过发起端（客户端）和/或服务端的协调处理，最终到达目标位置;

因此，执行这样的同步要求：

1. 两台服务器都安装了 rsync 程序，这是为了保证发起端有这个命令能发起同步，服务端有守护进程能接受请求。
2. 服务端能够登录发客户端，因为其需要读取客户端服务器上的数据。

为了满足上面的要求，

```bash
rsync -azv -e "ssh -p 2222" /path/to/source_dir {User}@{Server B IP}:/path/to/sync_dir
```
